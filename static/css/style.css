body {
    margin: 0;
    padding: 20px;
    font-family: Inter, Arial, sans-serif;
    transition: background-color 0.3s, color 0.3s;
}

.chartToolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
  gap: 16px;
  padding: 10px 12px;
  border-radius: 8px;
  background: var(--panel-bg);
  box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.chartToolbar .toolbar-left,
.chartToolbar .toolbar-center,
.chartToolbar .toolbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
}
.chartToolbar .toolbar-center { gap: 20px; }
.toolbar-section { display: flex; align-items: center; gap: 6px; }
.chartToolbar label { font-size: 12px; color: var(--muted); margin-right:4px; }
.chartToolbar button { padding:6px 8px; border-radius:6px; border:1px solid var(--border); background:transparent; color:var(--text); cursor:pointer; font-size:12px; transition:all 0.15s; }
.chartToolbar button:hover { background:rgba(0,0,0,0.08); border-color:var(--accent); }
.chartToolbar .toolbar-right button { background:var(--accent); color:var(--accent-contrast); border:none; }
.chartToolbar .toolbar-right button:hover { opacity:0.9; }
.chartToolbar .indicatorButtons button { padding:5px 8px; font-size:11px; }
:root {
    --bg: #ffffff;
    --panel-bg: #ffffff;
    --text: #000000;
    --muted: #666666;
    --border: #d0d0d0;
    --accent: #007bff;
    --accent-contrast: #ffffff;
    --danger: #c92a2a;
    --success: #0a8a0a;
    --stale: #d08f00;
    --input-bg: #ffffff;
    --input-text: #000000;
}

@media (prefers-color-scheme: dark) {
    :root {
        --bg: #1e1e1e;
        --panel-bg: #252525;
        --text: #e0e0e0;
        --muted: #a8a8a8;
        --border: #444444;
        --accent: #1f9cff;
        --accent-contrast: #0b1220;
        --danger: #ff6b6b;
        --success: #57d391;
        --stale: #f0b84b;
        --input-bg: #2a2a2a;
        --input-text: #e6e6e6;
    }
}

body.light {
    --bg: #ffffff;
    --panel-bg: #ffffff;
    --text: #000000;
    --muted: #666666;
    --border: #d0d0d0;
    --accent: #007bff;
    --accent-contrast: #ffffff;
    --danger: #c92a2a;
    --success: #0a8a0a;
    --stale: #d08f00;
    --input-bg: #ffffff;
    --input-text: #000000;
    background-color: var(--bg);
    color: var(--text);
}

body.dark {
    --bg: #1e1e1e;
    --panel-bg: #252525;
    --text: #e0e0e0;
    --muted: #a8a8a8;
    --border: #444444;
    --accent: #1f9cff;
    --accent-contrast: #0b1220;
    --danger: #ff6b6b;
    --success: #57d391;
    --stale: #f0b84b;
    --input-bg: #2a2a2a;
    --input-text: #e6e6e6;
    background-color: var(--bg);
    color: var(--text);
}

h2, h3, h4 {
    margin: 10px 0;
}

#tabs {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 10px;
}

#tabs button {
    padding: 5px 12px;
    border: 1px solid var(--border);
    border-radius: 4px;
    background-color: var(--panel-bg);
    color: var(--text);
    cursor: pointer;
    transition: background-color 0.15s, color 0.15s, border-color 0.15s;
}

#tabs button:hover {
    background-color: rgba(0,0,0,0.1);
}

#tabs button.active {
    background-color: #007bff;
    color: #ffffff;
    border-color: #0056b3;
}

#tabs button.tab-btn {
    padding: 5px 12px;
}

#tabs input[type="text"] {
    padding: 5px;
    border-radius: 4px;
    border: 1px solid #888;
    flex: 1;
    min-width: 120px;
}

#tabs #renameTabBtn {
    padding: 5px 10px;
    border-radius: 4px;
    border: 1px solid #888;
    cursor: pointer;
}

#themeSwitch {
    margin-bottom: 10px;
}

#themeSelect {
    padding: 5px;
    border-radius: 4px;
    border: 1px solid #888;
    cursor: pointer;
}

/* ---------------------- Indicator Panel ---------------------- */
#indicatorPanel {
    border: 1px solid #888;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 10px;
    background-color: inherit;
}

#indicatorPanel button {
    padding: 5px 10px;
    margin: 2px;
    border: 1px solid #888;
    border-radius: 4px;
    background-color: inherit;
    color: inherit;
    cursor: pointer;
    transition: background-color 0.2s;
}

#indicatorPanel button:hover {
    background-color: rgba(0,0,0,0.1);
}

#activeIndicators div {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 3px 0;
}

#activeIndicators div button {
    padding: 2px 5px;
    font-size: 12px;
}

#presetsPanel {
    margin-top: 10px;
}

#presetsPanel button {
    padding: 5px 10px;
}

#chartContainer {
    border: 1px solid #888;
    border-radius: 6px;
    padding: 5px;
    background-color: inherit;
}

#appHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

#appHeader h1 {
    margin: 0;
    font-size: 20px;
    letter-spacing: 0.4px;
}

.subtitle {
    margin: 2px 0 0 0;
    font-size: 12px;
    color: #666;
}

#statusBar {
    text-align: right;
    font-size: 13px;
}

#statusBar .status-ok {
    color: #0a8a0a;
}

#statusBar .status-error {
    color: #c92a2a;
}

#statusBar .status-stale {
    color: #d08f00;
}

.mainContent {
    display: grid;
    grid-template-columns: minmax(180px, 360px) 8px 1fr;
    gap: 12px;
    align-items: start;
}

#leftPanel {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.splitter {
    width: 8px;
    background: linear-gradient(90deg, transparent, rgba(0,0,0,0.06), transparent);
    cursor: col-resize;
    border-radius: 4px;
    align-self: stretch;
    margin: 0 4px;
}
.splitter:hover { background: linear-gradient(90deg, transparent, rgba(0,0,0,0.12), transparent); }

#leftPanel > div, #leftPanel #tabs {
    background: var(--panel-bg);
    border: 1px solid var(--border);
    padding: 12px;
    border-radius: 8px;
}

#symbolBar {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.indicatorButtons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.indicatorButtons button {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: linear-gradient(180deg, var(--panel-bg), rgba(0,0,0,0.02));
}

.panelActions {
    display:flex;
    gap:8px;
    margin-top:10px;
}

#rightPanel {
    min-width: 0;
}

#chartContainer {
    background: var(--panel-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
}

#settingsWrap {
    position: fixed;
    bottom: 12px;
    right: 12px;
    display: inline-flex;
    align-items: flex-end;
    gap: 8px;
    z-index: 70;
}

#settingsBtn {
    background: var(--panel-bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 10px 12px;
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

#settingsMenu {
    display: none;
    position: absolute;
    bottom: 56px;
    right: 0;
    background: var(--panel-bg);
    border: 1px solid var(--border);
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    min-width: 220px;
}

#settingsMenu[aria-hidden="false"] { display: block; }

.menu-row { display:flex; justify-content:space-between; align-items:center; gap:8px; }
.menu-row label { font-size:13px; color:var(--muted); }

.menu-buttons { display:flex; flex-wrap:wrap; gap:6px; }
.menu-buttons button { padding:5px 10px; border:1px solid var(--border); border-radius:5px; background:transparent; color:var(--text); cursor:pointer; font-size:12px; transition:all 0.15s; }
.menu-buttons button:hover { background:rgba(0,0,0,0.08); border-color:var(--accent); }

@media (max-width: 480px) {
    #settingsWrap { right: 8px; bottom: 12px; }
    #settingsMenu { min-width: 160px; bottom: 52px; }
}

#appFooter {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 12px;
    display: flex;
    justify-content: center;
    pointer-events: none;
    z-index: 55;
}
#appFooter .footerContent {
    pointer-events: auto;
    background: rgba(0,0,0,0.35);
    color: var(--muted);
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 13px;
    display: inline-flex;
    gap: 12px;
    align-items: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}
#appFooter a { color: var(--accent); text-decoration: none; }
#appFooter a:hover { text-decoration: underline; }

@media (max-width: 600px) {
    #appFooter .footerContent { font-size: 12px; padding: 6px 10px; }
    #settingsWrap { bottom: 12px; right: 12px; }
}

#loadingIndicator { display: none; align-items: center; gap: 8px; font-size: 12px; color: var(--muted); margin-left: 8px; }
#loadingIndicator .spinner {
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255,255,255,0.12);
    border-top-color: var(--accent);
    border-radius: 50%;
    box-shadow: 0 1px 0 rgba(0,0,0,0.2) inset;
    animation: spin 0.72s linear infinite;
}
#loadingIndicator .loaderText { opacity: 0.95; }
@keyframes spin { to { transform: rotate(360deg); } }

#fetchProgress { display: none; height: 4px; border-radius: 6px; overflow: hidden; background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); }
#fetchProgress::before {
    content: '';
    display: block;
    height: 100%;
    width: 20%;
    background: linear-gradient(90deg, var(--accent), color-mix(in srgb, var(--accent) 60%, transparent));
    animation: prog 1.2s linear infinite;
}
@keyframes prog { 0% { transform: translateX(-120%); } 100% { transform: translateX(220%); } }

header#appHeader, .mainContent {
    max-width: 100%;
    margin-left: auto;
    margin-right: auto;
}

#appHeader h1 {
    font-weight: 600;
    font-size: 22px;
}
.subtitle {
    color: var(--muted);
    margin-top: 4px;
}

#statusBar { font-size: 13px; color: var(--muted); }

#tabs { padding: 6px 8px; display:flex; gap:8px; flex-wrap:wrap; }
#tabs button.tab-btn { border-radius: 999px; padding:6px 12px; font-size:13px; }
#tabs button.tab-btn:hover { transform: translateY(-1px); }

#tabs button.active { background: linear-gradient(180deg,var(--accent),color-mix(in srgb, var(--accent) 70%, transparent)); color: var(--accent-contrast); box-shadow: 0 6px 16px rgba(0,0,0,0.12); }

#activeIndicators { display:flex; flex-direction:column; gap:6px; margin-top:8px; }
#activeIndicators div { background: rgba(0,0,0,0.03); border-radius:6px; padding:6px 8px; display:flex; justify-content:space-between; align-items:center; }
#activeIndicators div button { background:transparent; border:1px solid var(--border); padding:4px 6px; border-radius:5px; }

#presetsPanel { display:flex; gap:8px; margin-top:10px; }
#presetsPanel button { padding:6px 10px; border-radius:6px; }

button[id^="download"], .panelActions button {
    background: var(--accent);
    color: var(--accent-contrast);
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
}
button[id^="download"]:hover { transform: translateY(-2px); }

@media (min-width: 900px) {
    #leftPanel { position: sticky; top: 20px; align-self:start; }
}

@media (max-width: 900px) {
    .mainContent { grid-template-columns: 1fr; }
    #settingsWrap { right: 12px; bottom: 12px; }
}

.resizable-panel {
    width: 100%;
    height: 600px;
}

input, select, button {
    font-family: inherit;
    font-size: 14px;
}

button:active {
    transform: scale(0.98);
}

#symbolBar {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
}

#symbolBar label {
    font-weight: bold;
}

#symbolBar select,
input, select, textarea, button {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background-color: var(--input-bg);
    color: var(--input-text);
    cursor: pointer;
    font-size: 14px;
    min-width: 120px;
}

input:focus, select:focus, textarea:focus, button:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.12);
    border-color: var(--accent);
}

::placeholder { color: var(--muted); }


#autocomplete {
    position: absolute;
    background: var(--bg);
    border: 1px solid #444;
    max-height: 150px;
    overflow-y: auto;
    width: 200px;
    display: none;
}

.autocomplete-item {
    padding: 6px;
    cursor: pointer;
}

.autocomplete-item:hover {
    background: #666;
}

.panelCard { background: var(--panel-bg); border: 1px solid var(--border); padding: 12px; border-radius: 8px; }
.panelTitle { margin: 0 0 8px 0; font-size: 14px; color: var(--muted); font-weight:600; }
.tabsPanel { display:flex; gap:8px; flex-wrap:wrap; }

#tabs { padding: 6px 8px; display:flex; gap:8px; flex-wrap:wrap; }
#tabs button { padding: 6px 12px; border-radius: 999px; background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border: 1px solid rgba(255,255,255,0.04); color: var(--text); cursor: pointer; transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s; }
#tabs button:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,0.08); background: linear-gradient(180deg, rgba(255,255,255,0.04), transparent); }
#tabs button.active { background: linear-gradient(90deg,var(--accent), color-mix(in srgb, var(--accent) 70%, transparent)); color: var(--accent-contrast); box-shadow: 0 8px 20px rgba(0,0,0,0.22); border-color: color-mix(in srgb, var(--accent) 50%, transparent); }

.chartToolbar .toolbar-right button { background: linear-gradient(180deg,#2b8cff,#1b6fe6); color: #fff; border:none; padding:8px 12px; border-radius:8px; box-shadow: 0 8px 22px rgba(27,111,230,0.18); display:inline-flex; align-items:center; gap:8px; }
.chartToolbar .toolbar-right button#downloadJSON { background: linear-gradient(180deg,#20c997,#17a673); box-shadow: 0 8px 22px rgba(23,166,115,0.18); }
.chartToolbar .toolbar-right button:hover { transform: translateY(-2px); opacity:0.98; }
.viewTabs { display:flex; gap:8px; margin-bottom:8px; border-bottom:1px solid var(--border); padding-bottom:8px; }
.viewTab { padding:8px 12px; border-radius:6px; border:1px solid transparent; background:transparent; color:var(--text); cursor:pointer; font-size:13px; transition:all 0.15s; }
.viewTab:hover { background:rgba(0,0,0,0.05); }
.viewTab.active { background:var(--accent); color:var(--accent-contrast); border-color:var(--accent); }

#scannerResults { width:100%; }
.scanner-table { width:100%; border-collapse:collapse; }
.scanner-table th { background:var(--panel-bg); color:var(--text); padding:10px; text-align:left; font-size:12px; font-weight:600; border-bottom:2px solid var(--border); cursor:pointer; }
.scanner-table th:hover { background:rgba(0,0,0,0.08); }
.scanner-table td { padding:10px; border-bottom:1px solid var(--border); font-size:12px; }
.scanner-table tr:hover { background:rgba(0,0,0,0.02); }
.scanner-score-high { color:#57d391; font-weight:600; }
.scanner-score-mid { color:#f0b84b; font-weight:600; }
.scanner-score-low { color:#ff6b6b; font-weight:600; }
.scanner-trend-bull { color:#57d391; }
.scanner-trend-bear { color:#ff6b6b; }
.scanner-trend-flat { color:var(--muted); }

#mlPanel {
    background: linear-gradient(135deg, var(--panel-bg) 0%, rgba(88, 166, 255, 0.05) 100%);
    border-top: 2px solid var(--accent);
}

#mlPanel h3 {
    color: var(--accent);
    font-weight: 600;
}

#mlMetrics {
    background: rgba(0, 0, 0, 0.2);
    padding: 12px;
    border-radius: 6px;
    border-left: 3px solid var(--accent);
    font-family: 'Monaco', monospace;
    white-space: pre-line;
    word-break: break-word;
}

.ml-score-good { color: #57d391; font-weight: 600; }
.ml-score-bad { color: #ff6b6b; font-weight: 600; }
.ml-score-neutral { color: var(--muted); }

@media (max-width: 768px) {
    #tabs {
        flex-direction: column;
        gap: 5px;
    }
    
    #tabs input[type="text"] {
        width: 100%;
    }
    
    #chartContainer {
        height: 400px;
    }
}